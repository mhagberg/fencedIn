<template name="jobHistory">
    <div class="container-fluid gutter-small jobLink">
        <div class="row">
        <div class="col-md4"><h2 class="text-center">Job History</h2></div>
        </div>
        <div class="row show-grid gutter-small">
            {{#with job}}
            <div class="col-md-4">
                <h5>Job Details:</h5>
                <address class="bg-primary img-rounded job-info">
                    <abbr title="Name">Job Name:</abbr> {{name}}<br/><br/>
                    <abbr title="Job Number">Job #:</abbr> {{number}}<br><br>
                    <abbr title="Job Create Date">Create Date:</abbr> {{formatDate createDate "long"}}<br><br>
                    <abbr title="Job Type">Job Type:</abbr> {{type}}
                </address>
            </div>
            {{/with}}
            <p></p>

            <div class="col-md-4">
                <h5>Address:</h5>
                <address class="bg-primary img-rounded job-info">
                    {{#with address}}
                    {{address1}}, {{address2}}<br><br>
                    {{city}}, WA {{zip}}<br><br>
                    {{/with}}
                    <abbr title="Phone">Phone:</abbr> {{job.phone}}
                </address>
            </div>
            {{#with job}}
            <div class="col-md-4">
                <h5>Job Progress:</h5>
                <address class="bg-primary img-rounded job-info">
                    <abbr title="Job Est Start Date">Est Start:</abbr> {{formatDate estStartDate "long"}}<br/><br/>
                    <abbr title="Job Start Date">Start:</abbr> {{formatDate startDate "long"}}<br/><br/>
                    <abbr title="Job Est Finish Date">Est Finish:</abbr> {{formatDate estFinishDate "long"}}<br/><br/>
                    <abbr title="Job Est Finish Date">Finished:</abbr> {{formatDate finishDate "long"}}
                </address>
            </div>
            {{/with}}
        </div>
        <div class="row">
            <div class="col-md-4">
                <h5>Job Owners:</h5>
                <address class="bg-primary img-rounded gutter-small">
                    <abbr title="Foreman">Foreman:</abbr> {{foreman.name}}<br/><br/>
                    <abbr title="Salesman">Salesman:</abbr> {{salesman.name}}
                </address>
            </div>
            {{#with job}}
            <div class="col-md-8">
                <h5>Job Notes:</h5>
                <address class="bg-primary img-rounded gutter-small">
                    <abbr title="Notes">Notes:</abbr> {{notes}}
                </address>
            </div>
            {{/with}}
        </div>

    </div>
    <div class="container-fluid gutter-small">
        <div class="row">
            {{#with job}}
            <div class="col-md-3"><button type="button" class="btn-primary btn-xs" id="checkInBtn" data-job-id="{{_id}}"><span class="glyphicon glyphicon-ok-circle" aria-hidden="true">Check-In</span></button></div>
            {{#if showCheckOutOnLastCheckIn _id}}
            <div class="col-md-3"><button type="button" class="btn-success btn-xs" id="checkOutBtn" data-job-id="{{_id}}"><span class="glyphicon glyphicon-ok-circle" aria-hidden="true">Check-Out</span></button></div>
            {{/if}}
            {{#unless finishDate}}
            <div class="col-md-3"><button type="button" class="btn btn-danger" id="finishBtn" data-job-id="{{_id}}"><span class="glyphicon glyphicon-saved" aria-hidden="true">Finish</span></button></div>
            {{/unless}}
            {{/with}}
        </div>
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <td class="table-text-small">
                Check-In Time
            </td>
            <td class="table-text-small">
                Check-Out Time
            </td>
            <td class="table-text-small">
                Load & Travel
                (in minutes)
            </td>
            <td class="table-text-small">
                Had all
                Tools &
                Materials
            </td>
            <td class="table-text-small">
                Additional
                Materials
                Required
            </td>
            <td class="table-text-small">
                Contact
                Customer
            </td>
            <td class="table-text-small">
                Daily
                Picture
            </td>
            <td class="table-text-small">
                Foreman
            </td>
            <td class="table-text-small">
                Fencer
            </td>
            <td class="table-text-small" colspan="3">
                Daily
                Notes
            </td>
        </tr>
        </thead>
        <tbody>
        {{#each checkIns}}
        <tr class="checkInLink">
            <td class="table-text-small">
                {{formatDate checkInTime "long"}}
            </td>
            <td class="table-text-small">
                {{#if checkOutTime}}
                {{formatDate checkOutTime "long"}}
                {{/if}}
            </td>
            <td class="table-text-small">
                {{loadTimePlusTravelTime _id}}
            </td>
            <td class="table-text-small">
                {{#if toolsMaterials}}
                <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                {{/if}}
                {{#unless toolsMaterials}}
                <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
                {{/unless}}
            </td>
            <td class="table-text-small">
               {{additionalMaterials}}
            </td>
            <td class="table-text-small">
                {{#if contactCustomer}}
                <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                {{/if}}
                {{#unless contactCustomer}}
                <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
                {{/unless}}
            </td>
            <td class="table-text-small">
                {{#if dailyPicture}}
                <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                {{/if}}
                {{#unless dailyPicture}}
                <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
                {{/unless}}
            </td>
            <td class="table-text-small">
                {{ > foremanDisplay foremanId=foreman_id}}
            </td>
            <td class="table-text-small">
                {{ > fencerDisplay fencerId=fencer_id}}
            </td>
            <td class="table-text-small" colspan="3">
                {{notes}}
            </td>
        </tr>
        {{/each}}
        </tbody>
        </table>

        <h3>CheckIn Pictures</h3>
        <div class="row gutter-small">
            {{#each pictures}}
            <div class="col-lg-1 col-md-2 col-xs-3 gutter-small">
                <a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title="{{formatDate createDate 'long'}}" data-caption="Job Check In Picture" data-image="{{image}}" data-target="#image-gallery">
                    <img class="img-responsive" width='100' src="{{image}}">
                </a>
            </div>
            {{/each}}
        </div>
    </div>

    {{> imageModal}}

</template>

<template name="imageModal">
<div class="modal fade" id="image-gallery" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="image-gallery-title"></h4>
            </div>
            <div class="modal-body">
                <img id="image-gallery-image" class="img-responsive" src="">
            </div>
            <div class="modal-footer">

                <div class="col-md-2">
                    <button type="button" class="btn btn-primary" id="show-previous-image">Previous</button>
                </div>

                <div class="col-md-8 text-justify" id="image-gallery-caption">

                </div>

                <div class="col-md-2">
                    <button type="button" id="show-next-image" class="btn btn-default">Next</button>
                </div>
            </div>
        </div>
    </div>
</div>
</template>